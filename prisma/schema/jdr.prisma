// File: prisma/jdr.prisma

// --- JDR / TAROT MODULE ---

model Card {
    id        String  @id @default(cuid())
    name      String
    imagePath String
    shortDesc String?
    fullDesc  String?

    @@schema("jdr")
}

model Room {
    id          String @id @default(cuid())
    code        String @unique
    gmSessionId String

    isLocked    Boolean @default(false)
    visibility  String  @default("ALL")
    allowRevoke Boolean @default(true)

    activePlayerId String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    players Player[]
    draws   Draw[]

    @@schema("jdr")
}

model Player {
    id     String @id @default(cuid())
    pseudo String
    roomId String
    room   Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)

    draws Draw[]

    @@schema("jdr")
}

model Draw {
    id       String @id @default(cuid())
    roomId   String
    room     Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)
    playerId String
    player   Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

    // Stores snapshot of cards: [{ cardId, position, isReversed, isRevealed }]
    cardsSnapshot Json

    timestamp DateTime @default(now())

    @@schema("jdr")
}
