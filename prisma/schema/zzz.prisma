// ------------------------------------------
// 1. ZZZ ENUMS (Specific to Zenless Zone Zero)
// ------------------------------------------

enum ZZZAttribute {
    ICE
    FIRE
    ELECTRIC
    PHYSICAL
    ETHER
}

enum ZZZSpecialty {
    ATTACK
    STUN
    SUPPORT
    DEFENSE
    ANOMALY
}

enum ZZZDiscSlot {
    ONE
    TWO
    THREE
    FOUR
    FIVE
    SIX
}

enum ZZZStatType {
    HP_FLAT
    HP_PERCENT
    ATK_FLAT
    ATK_PERCENT
    DEF_FLAT
    DEF_PERCENT
    CRIT_RATE
    CRIT_DMG
    PEN_FLAT
    PEN_PERCENT
    ANOMALY_MASTERY
    ANOMALY_PROFICIENCY
    IMPACT
    ENERGY_REGEN
    ICE_DMG
    FIRE_DMG
    ELECTRIC_DMG
    PHYSICAL_DMG
    ETHER_DMG
}

// ------------------------------------------
// 2. ZZZ REFERENCE DATA (Static Game Info)
// ------------------------------------------

model ZZZAgent {
    id        String       @id @default(uuid())
    name      String       @unique
    rarity    String // "S" or "A"
    attribute ZZZAttribute
    specialty ZZZSpecialty
    faction   String

    // Base Stats at Max Level (Lv 60) for Audit
    baseHp      Int
    baseAtk     Int
    baseDef     Int
    baseImpact  Int
    baseAnomaly Int
    baseEnergy  Float @default(1.2)

    // Substat Scorer Priority
    prioritySubstats ZZZStatType[]

    // Relations
    builds          ZZZBuild[]
    recommendedGear ZZZAgentWEngineRec[]

    @@map("zzz_agent") // Optional: Use this to enforce snake_case table names in DB
}

model ZZZWEngine {
    id     String @id @default(uuid())
    name   String @unique
    rarity String // "S", "A", "B"

    // Base Stats Maxed
    baseAtk Int
    advStat ZZZStatType
    advVal  Float

    // Relations
    builds         ZZZBuild[]
    recommendedFor ZZZAgentWEngineRec[]

    @@map("zzz_w_engine")
}

model ZZZDiscSet {
    id            String @id @default(uuid())
    name          String @unique
    twoPieceDesc  String
    fourPieceDesc String

    // Relations
    equippedDiscs ZZZEquippedDisc[]

    @@map("zzz_disc_set")
}

// Join Table for Recommendations
model ZZZAgentWEngineRec {
    agentId   String
    wEngineId String
    rank      Int
    notes     String?

    agent   ZZZAgent   @relation(fields: [agentId], references: [id])
    wEngine ZZZWEngine @relation(fields: [wEngineId], references: [id])

    @@id([agentId, wEngineId])
    @@map("zzz_agent_w_engine_rec")
}

// ------------------------------------------
// 3. ZZZ USER DATA (The Tracker)
// ------------------------------------------

model ZZZBuild {
    id      String @id @default(uuid())
    userId  String
    agentId String

    // Config
    name   String?
    cinema Int     @default(0)

    // Gear Selection
    wEngineId   String?
    wEngineStar Int     @default(1)

    // Relations
    user    User        @relation(fields: [userId], references: [id])
    agent   ZZZAgent    @relation(fields: [agentId], references: [id])
    wEngine ZZZWEngine? @relation(fields: [wEngineId], references: [id])

    discs ZZZEquippedDisc[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("zzz_build")
}

model ZZZEquippedDisc {
    id      String      @id @default(uuid())
    buildId String
    slot    ZZZDiscSlot
    setId   String

    // Stats
    level    Int         @default(15)
    mainStat ZZZStatType

    // Substats
    sub1Type ZZZStatType?
    sub1Val  Float?

    sub2Type ZZZStatType?
    sub2Val  Float?

    sub3Type ZZZStatType?
    sub3Val  Float?

    sub4Type ZZZStatType?
    sub4Val  Float?

    // Caching the Score
    tierScore String? // "S", "A", "B", "C"

    // Relations
    build   ZZZBuild   @relation(fields: [buildId], references: [id], onDelete: Cascade)
    discSet ZZZDiscSet @relation(fields: [setId], references: [id])

    @@unique([buildId, slot])
    @@map("zzz_equipped_disc")
}
